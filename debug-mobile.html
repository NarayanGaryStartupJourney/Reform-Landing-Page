<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reform - Mobile Debug</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #fff;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
        }
        
        .info-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .info-box h2 {
            font-size: 18px;
            margin-bottom: 12px;
            color: #ffd700;
        }
        
        .info-box p {
            margin: 8px 0;
            font-size: 14px;
            word-break: break-word;
        }
        
        .form-box {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        input[type="email"] {
            width: 100%;
            padding: 14px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            font-size: 16px;
            margin-bottom: 12px;
        }
        
        input[type="email"]::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        button {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
            color: #333;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
        }
        
        button:disabled {
            opacity: 0.5;
        }
        
        .log-box {
            background: #000;
            border-radius: 12px;
            padding: 15px;
            margin-top: 20px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        
        .log-entry {
            margin: 4px 0;
            padding: 4px;
            border-left: 3px solid #667eea;
            padding-left: 8px;
        }
        
        .log-entry.success {
            border-left-color: #00ff00;
            color: #00ff00;
        }
        
        .log-entry.error {
            border-left-color: #ff0000;
            color: #ff0000;
        }
        
        .log-entry.warning {
            border-left-color: #ffd700;
            color: #ffd700;
        }
        
        .log-entry.info {
            border-left-color: #00bfff;
            color: #00bfff;
        }
        
        .success-msg {
            background: rgba(0, 255, 0, 0.2);
            border: 2px solid #00ff00;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            display: none;
        }
        
        .error-msg {
            background: rgba(255, 0, 0, 0.2);
            border: 2px solid #ff0000;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            text-align: center;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Reform Mobile Debugger</h1>
        
        <div class="info-box">
            <h2>Device Info</h2>
            <p><strong>User Agent:</strong> <span id="userAgent"></span></p>
            <p><strong>Platform:</strong> <span id="platform"></span></p>
            <p><strong>Browser:</strong> <span id="browser"></span></p>
            <p><strong>Is Mobile:</strong> <span id="isMobile"></span></p>
            <p><strong>In-App Browser:</strong> <span id="isInApp"></span></p>
            <p><strong>Screen:</strong> <span id="screen"></span></p>
            <p><strong>Connection:</strong> <span id="connection"></span></p>
        </div>
        
        <div class="form-box">
            <h2>Test Form Submission</h2>
            <form id="testForm">
                <input type="email" id="email" placeholder="Enter test email" required>
                <button type="submit" id="submitBtn">Submit Test</button>
            </form>
            <div id="successMsg" class="success-msg">
                ‚úÖ Form submitted successfully!
            </div>
            <div id="errorMsg" class="error-msg">
                ‚ùå Submission failed!
            </div>
        </div>
        
        <div class="info-box">
            <h2>üìã Console Log</h2>
            <div id="logBox" class="log-box"></div>
        </div>
        
        <div class="info-box" style="margin-top: 20px;">
            <h2>üí° Instructions</h2>
            <p>1. Review your device info above</p>
            <p>2. Enter a test email and submit</p>
            <p>3. Watch the console log for details</p>
            <p>4. Check your Google Sheet: <a href="https://docs.google.com/spreadsheets/d/1-7LrlSC1cC9lv9yPyD6HziJAr2eLob2tiUITjV6ukz8/edit" style="color: #ffd700;" target="_blank">Open Sheet</a></p>
        </div>
    </div>
    
    <script>
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbw_NwzIbLuY2kUNa-nN2DV7crUwJt4my-mBZEQtvjUlJBYADCta7dttvUByKP9Q3nLh/exec';
        
        // Logger function
        function log(message, type = 'info') {
            const logBox = document.getElementById('logBox');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            const timestamp = new Date().toLocaleTimeString();
            entry.textContent = `[${timestamp}] ${message}`;
            logBox.appendChild(entry);
            logBox.scrollTop = logBox.scrollHeight;
            console.log(`[${type.toUpperCase()}]`, message);
        }
        
        // Detect device info
        function detectDevice() {
            const ua = navigator.userAgent;
            const platform = navigator.platform;
            
            // Detect mobile
            const isMobile = /iPhone|iPad|iPod|Android|webOS|BlackBerry|Windows Phone/i.test(ua);
            
            // Detect in-app browser
            const isInApp = /FBAN|FBAV|Twitter|Instagram|LinkedIn|Line|WeChat|Snapchat/i.test(ua);
            
            // Detect browser
            let browser = 'Unknown';
            if (ua.indexOf('Firefox') > -1) browser = 'Firefox';
            else if (ua.indexOf('SamsungBrowser') > -1) browser = 'Samsung Internet';
            else if (ua.indexOf('Opera') > -1 || ua.indexOf('OPR') > -1) browser = 'Opera';
            else if (ua.indexOf('Edge') > -1) browser = 'Edge';
            else if (ua.indexOf('Chrome') > -1) browser = 'Chrome';
            else if (ua.indexOf('Safari') > -1) browser = 'Safari';
            
            // Detect connection
            let connection = 'Unknown';
            if (navigator.connection) {
                connection = navigator.connection.effectiveType || 'Unknown';
            }
            
            document.getElementById('userAgent').textContent = ua;
            document.getElementById('platform').textContent = platform;
            document.getElementById('browser').textContent = browser;
            document.getElementById('isMobile').textContent = isMobile ? 'Yes' : 'No';
            document.getElementById('isInApp').textContent = isInApp ? 'Yes' : 'No';
            document.getElementById('screen').textContent = `${window.innerWidth}x${window.innerHeight}`;
            document.getElementById('connection').textContent = connection;
            
            log('Device detection complete', 'info');
            log(`Mobile: ${isMobile}, In-App: ${isInApp}`, 'info');
            
            return { isMobile, isInApp, browser };
        }
        
        // Initialize
        const deviceInfo = detectDevice();
        
        // Form submission
        document.getElementById('testForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value.trim();
            const submitBtn = document.getElementById('submitBtn');
            const successMsg = document.getElementById('successMsg');
            const errorMsg = document.getElementById('errorMsg');
            
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            
            log('=== FORM SUBMISSION STARTED ===', 'warning');
            log(`Email: ${email}`, 'info');
            
            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';
            
            let successHandled = false;
            
            function handleSuccess() {
                if (successHandled) {
                    log('Success already handled, skipping', 'warning');
                    return;
                }
                successHandled = true;
                log('‚úÖ SUBMISSION SUCCESSFUL', 'success');
                successMsg.style.display = 'block';
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Test';
                log('Check your Google Sheet now!', 'success');
            }
            
            function handleError(error) {
                if (successHandled) return;
                log(`‚ùå ERROR: ${error}`, 'error');
                errorMsg.style.display = 'block';
                errorMsg.textContent = `‚ùå Error: ${error}`;
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Test';
            }
            
            // Detect if in-app browser
            if (deviceInfo.isInApp) {
                log('Using IN-APP BROWSER method (GET with image beacon)', 'warning');
                
                const params = new URLSearchParams({
                    email: email,
                    source: 'debug_mobile_inapp',
                    timestamp: new Date().toISOString()
                });
                
                const url = `${GOOGLE_SCRIPT_URL}?${params.toString()}`;
                log(`Request URL: ${url.substring(0, 100)}...`, 'info');
                
                const img = new Image();
                img.style.display = 'none';
                
                img.onload = function() {
                    log('Image beacon loaded successfully', 'success');
                    handleSuccess();
                };
                
                img.onerror = function() {
                    log('Image beacon error (but request was sent)', 'warning');
                    handleSuccess(); // Still count as success
                };
                
                img.src = url;
                document.body.appendChild(img);
                
                log('Image beacon created and sent', 'info');
                
                // Fallback timeout
                setTimeout(() => {
                    log('Timeout reached - assuming success', 'warning');
                    handleSuccess();
                }, 2000);
                
            } else {
                log('Using STANDARD method (POST with iframe)', 'warning');
                
                // Create form
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = GOOGLE_SCRIPT_URL;
                form.target = 'hiddenFrame';
                form.style.display = 'none';
                
                // Add fields
                const emailField = document.createElement('input');
                emailField.type = 'hidden';
                emailField.name = 'email';
                emailField.value = email;
                
                const sourceField = document.createElement('input');
                sourceField.type = 'hidden';
                sourceField.name = 'source';
                sourceField.value = 'debug_mobile_standard';
                
                const timestampField = document.createElement('input');
                timestampField.type = 'hidden';
                timestampField.name = 'timestamp';
                timestampField.value = new Date().toISOString();
                
                form.appendChild(emailField);
                form.appendChild(sourceField);
                form.appendChild(timestampField);
                
                // Create iframe
                const iframe = document.createElement('iframe');
                iframe.name = 'hiddenFrame';
                iframe.style.display = 'none';
                
                log('Created form and iframe', 'info');
                
                document.body.appendChild(iframe);
                document.body.appendChild(form);
                
                // Handle iframe load
                iframe.onload = function() {
                    log('iframe.onload fired!', 'success');
                    handleSuccess();
                };
                
                iframe.onerror = function() {
                    log('iframe.onerror fired', 'error');
                    handleError('iframe error');
                };
                
                // Submit form
                log('Submitting form...', 'info');
                form.submit();
                log('Form.submit() called', 'info');
                
                // iOS/Mobile fallback timeout
                setTimeout(() => {
                    log('Fallback timeout - assuming success (iOS behavior)', 'warning');
                    handleSuccess();
                }, 2500);
                
                // Cleanup
                setTimeout(() => {
                    if (form.parentNode) form.remove();
                    if (iframe.parentNode) iframe.remove();
                    log('Cleaned up form and iframe', 'info');
                }, 5000);
            }
        });
        
        log('Debug page ready!', 'success');
        log('Script URL configured: ' + GOOGLE_SCRIPT_URL.substring(0, 50) + '...', 'info');
    </script>
</body>
</html>

